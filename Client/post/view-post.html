<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/view-post.css" />
    <title>Post View</title>
  </head>
  <body onload="loadPost()">
    <article class="post-wrapper">
      <section class="post">
        <header id="post-header" class="post-header">
          <section id="post-content"></section>

          <section class="comment-section">
            <h2>Comments</h2>
            <ul id="comments-section"></ul>
            <form onsubmit="postComment(); return false" id="comment-form">
              <input
                type="text"
                name="submit-comment"
                placeholder="Write your comment here"
                required
              />
              <input type="submit" value="Submit" />
            </form>
          </section>
        </header>
        <picture class="post-picture"
          ><img id="dish-img" class="post-img" src="" alt="fish dish"
        /></picture>
      </section>
    </article>
    <script src="../js/view-post.js"></script>
    <script src="../js/endpoints-sdk.js"></script>
    <script>
      fetchComment = () => {
        // TODO: fetch/read post id and token from storage
        let comments_endpoint = `http://${hosts[currentHost]}${endpoints.getComments}`;
        let { endpoint, request } = new ApiCall(comments_endpoint, "GET")
          .withCredentials()
          .withQueryParams({ id: 'xx' })
          .withHeader(
            "Authorization",
            `Bearer ${xx}`
          )
          .withHeader("Content-Type", "application/json")
          .build();

        Promise.allSettled([callAPI(endpoint, request)]).then((results) => {
          let comments = results[0].value;

          populateComments(comments);
          console.log(results[0].value);
        });
      };
    </script>
  </body>
</html>
